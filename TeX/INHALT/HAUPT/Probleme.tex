\chapter{Probleme}
\label{sec:Probleme}

Dieses Kapitel behandelt Schwierigkeiten, die bei der Arbeit mit ChatScript aufgetaucht sind und haben für uns ein ernstes und großes Hindernis dargestellt. Im Falle des zweiten Problems haben wir auch keine Lösung gefunden.\\


\section{Zwei-Query-Problem}
\label{Section: Zwei-Query Problem}

Ein Problem, wofür ein Workaround gefunden werden konnte, war das 'Zwei-Query-Problem'. Dieses Problem ist in den allen Versionen vorhanden und tritt wegen einem der folgenden Fehler auf:

\begin{enumerate}
\item {Suche auf einer vor der Nutzung existierenden Datenbank}
\item {Fehlschlag in Queries}
\end{enumerate}  

Ersteres tritt auf, wenn man mit Hilfe des Befehls \lstinline|:build onesentence| oder Ähnliches den Bot, hier onesentence, neu kompiliert. Dies hat den Ursprung darin, dass der Bezeichner für die Datenbanken per Client mit einer Zufallszahl konkateniert wird und jeder 'Build'-Befehl dieselbe Zufallszahl generiert. Wird eine Tabelle nach Nutzung nicht gelöscht, dann tritt dieser Fehlschlag auf.\\
Dieses Problem erscheint in dieser Form nicht außerhalb des Testens, da es unwahrscheinlich ist, dass zwei Tabellen mit demselben Bezeichner zufallsgeneriert werden. Das Problem entsteht nicht, wenn ein Bot regelmäßig, das heißt durch Verabschiedung in ~ende, beendet wird. Man kann dieses Problem manuell durch explizite drop-Befehle außerhalb von Chatscript behandeln. Findet eine solche Verabschiedung statt, tritt dies Problem nicht auf.\\
Zweiteres trat auf, wenn mit den angegebenen Eigenschaften kein Produkt gefunden werden konnte. Wenn kein Produkt gefunden werden kann, ist laut Skript in den Zustand '~ende.SETNULLANDREP' überzugehen, um eine neue Suche zu gewährleisten. Nach der Programmlogik müssten hier die einzelnen Regeln bis zu der Datenbanksuche wieder iteriert werden, um Nutzerangaben zu sammeln. Stattdessen versuchte der Bot nach dem Zurücksetzen der Variablen, erneut eine Suche mit NULL-Variablen auszuführen, indem er eigenständig in SUMMARY sprang und ohne eine Antwort abzuwarten eine Suche startete.\\
Dieses Problem wurde größtenteils umgangen, indem man den Nutzer mehrmals hintereinander fragt, ob man eine neue Suche ausführen will. Der Ursprung dieses Problems bleibt jedoch ungeklärt. Eine Vermutung ist, dass ChatScript intern Regeln, die bereits besucht worden sind, markiert, um nicht erneut von alleine in jene Regeln überzugehen und so Wiederholungen im Gesprächsablauf zu vermeiden \cite{chatscript2019}.\\


\section{Probleme mit der GUI}
\label{sec: Probleme mit der GUI}

Bei dem Testen der GUI fallen einige Probleme auf: 

\begin{enumerate}
\item{Fehlender Support von PostgreSQL-Server für Mac und Linux}
\item{Server mit PostgreSQL-Unterstüzung vs. Server ohne PostgreSQL-Unterstüzung}
\end{enumerate}

Das Testen der GUI erfolgte durch das Hosten auf Localhost (127.0.0.1) der durch ChatScript bereitgestellten Dateien im Ordner \textit{SERVER BATCH FILES} \citep{chatscript2019}. Während das Aufsetzen eines Servers auf Windows recht einfach war, fiel schnell auf, dass einige unvorhergesehene Probleme auftraten. 

\subsection{Fehlender Support von PostgreSQL-Server für Mac und Linux}
\label{sec:Fehlender Support von PostgreSQL-Server für Mac und Linux}

In der Dokumentation für ChatScript wird beschrieben, wie ein Server ohne Postgres-Unterstützung auf Windows, Mac und Linux-Distributionen aufzusetzen ist. Für Windows wird eine .bat Datei \textit{LocalPgServer.bat} beigeliefert, sodass das aufsetzen eines Servers auf Windows keine Probleme bereitet. Im Gegensatz dazu wird nichts über Server mit Postgres-Support für Linux oder Mac in der Dokumentation erwähnt. Nach mehreren erfolglosen Versuchen wurde im Forum für Chatbots \textcolor[rgb]{1,0.68,0.36}{HIER DEN LINK EINFÜGEN!!!} nachgefragt, wobei diese Antwort unbeantwortet blieb. 

\subsection{Server mit PostgreSQL-Unterstüzung vs. Server ohne PostgreSQL-Unterstüzung}
\label{sec: Server mit PostgreSQL-Unterstüzung vs. Server ohne PostgreSQL-Unterstüzung}

Ein weiteres Problem bei dem Testen der GUI war, dass der Bot verschiedene Verhaltensweisen je nach .bat-Datei aufweist. So entspricht der Programmablauf des Bots dem der Konsolenausgabe, wenn ein Server ohne Postgres-Support, zum Beispiel durch \textit{LocalServer.bat}, eingerichtet wird. Hier verhält sich der Bot in den Zustandsübergängen identisch zu der Konsolenausgabe, mit dem Unterschied, dass der Nutzer  bei der GUI / des Webinterfaces die erste Eingabe machen muss.\\
Das bedeutet, dass bis zum Zeitpunkt der Datenbankabfrage in Dbsearch keine Probleme auftreten. Zu Schwierigkeiten kommt es in diesem Fall verständlicherweise erst dann, wenn eine Datenbankabfrage ausgeführt werden muss, da hier keine Unterstützung für PostgreSQL besteht.\\
Im Gegensatz dazu gab es in vieler Hinsicht Probleme mit der Einrichtung eines Servers mit Postgres-Unterstüzung. Bei einigen Anläufen startete der Bot gar nicht, im besten Fall wird ~dbsearch.RESPONSE erreicht, jedoch geht der Bot von dort aus in keine weitere Regel, sondern iteriert weitergehend auf ~dbsearch.RESPONSE.\\
In vielen Versuchen erwiesen sich Übergänge in Regeln mit \lstinline|^reuse ()| als problematisch. Bei Aufsetzen des Servers mit \textit{LocalPgServer.bat}, ist es vorgekommen, dass einige der vorgesehenen Regelübergänge per \lstinline|^reuse()| nicht aktiviert wurden. \\
Da Probleme mit \textit{LocalPgServer.bat} nicht in der Dokumentation von ChatScript behandelt werden und der Macher und Entwickler von ChatScript, Bruce Wilcox, nicht auf Nachfragen mit dem Hosten eines Servers mit Postgres-Unterstützung antwortet \textcolor[rgb]{1,0.68,0.36}{LINK EINFÜGEN}, konnten alle Probleme mit dem Server mit Postgres-Unterstützung zeitnah nicht gelöst werden.\\
Es besteht unsererseits die Vermutung, dass es bei \textit{LocalPgServer.bat} Schwierigkeiten mit der User-Datenbank gibt, die ChatScript automatisch erstellt. In der Datenbank \textit{user} werden die einzelnen User mit Name und deren Protokolle abgespeichert. Diese Protokolle sind auch über den Ordner \textit{USER} zugänglich und tragen den Namen \textit{topic\_username\_botname.txt}. Interessanterweise wird bei \textit{LocalPgServer.bat} zwar ein Protokoll für den Benutzer angelegt, das existiert aber nur in der Datenbank und erscheint in dem USERS-Ordner nicht. Zudem bricht es nach SUMMARY ab, als wäre der Bot noch immer in diesem Zustand, obwohl die Datenbanksuche schon ausgeführt wurde und er aufgrund des ausgegebenen Textes schon in der Regel RESPONSE sein müsste.\\
Wie bereits erwähnt, tritt dieses Problem bei der Version über die Konsole und \textit{LocalSever.bat} nicht auf. Hier die Protokollführung nicht ab und die entsprechenden Protokolle sind über USERS einsehbar.\\
In der Datei \textit{bugs.txt} aus dem Ordner \textit{LOGS} wird das Problem folgendermaßen beschrieben: \lstinline{Postgres filessys write failed for USERS/topic\_127001\_augusta.txt}. Eine Suche über Google ergab, dass diese Beschreibung schon bei Schwierigkeiten mit ChatScript und dem Amazon Server aufgetaucht war (\url{https://www.chatbots.org/ai_zone/viewthread/3664/}). Die dortige Lösung das Problems, das Unique-Constraint der Relation \textit{userfiles} zu entfernen, haben wir auf unseren Fall übertragen und ausprobiert, allerdings hat dies nicht den gewünschten Effekt gehabt.\\
Aufgrund Zeitmangels, mangelnder Dokumentation und fehlender Einsicht in die Binärdateien bzw. Konfiguration ist dieses Problem bis dato nicht gelöst. Die genaue Fehlerquelle konnte nicht ausfindig gemacht werden und es ist ein Rätsel, warum auch Nicht-Postgres-Abläufe sich bei dem Server mit Postgres-Unterstützung anders verhalten als ohne Postgres-Unterstützung.
